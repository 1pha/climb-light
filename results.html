<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>분석 결과 - Climb Light</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Ads -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4436266100487526"
        crossorigin="anonymous"></script>
</head>

<body>
    <div class="container">
        <header class="header-compact">
            <a href="upload.html" class="back-link"><i class="fas fa-arrow-left"></i> 다시 업로드</a>
            <div class="logo-container-small">
                <img src="assets/logo.png" alt="Climb Light" style="height: 30px;">
            </div>
        </header>

        <main class="main-content">
            <div class="results-header">
                <h3>🎉 최고의 순간들을 찾았습니다!</h3>
                <p class="text-light">AI가 선정한 하이라이트 장면입니다.</p>
            </div>

            <div id="resultsGrid" class="results-grid">
                <!-- Results will be injected here by JS -->
                <div class="loading-spinner"></div>
            </div>

            <div id="noResults" style="text-align: center; margin-top: 4rem; display: none;">
                <div class="upload-icon" style="font-size: 5rem;">🤔</div>
                <h2>하이라이트를 찾을 수 없습니다</h2>
                <p style="font-size: 1.1rem; color: var(--text-secondary); margin-bottom: 2rem;">
                    영상을 먼저 업로드해주세요!
                </p>
                <a href="upload.html" class="btn btn-primary btn-large">영상 업로드하기</a>
            </div>

            <div class="action-buttons">
                <button id="shareBtn" class="btn btn-secondary">
                    <i class="fas fa-share-alt"></i> 공유하기
                </button>
                <a href="upload.html" class="btn btn-primary">
                    <i class="fas fa-redo"></i> 다른 영상 분석하기
                </a>
            </div>

            <!-- Google Ads -->
            <div class="ad-container" style="margin-top: 2rem;">
                <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4436266100487526"
                    data-ad-slot="auto" data-ad-format="auto" data-full-width-responsive="true"></ins>
                <script>
                    (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
            </div>
        </main>

        <footer class="footer">
            <p>&copy; 2025 Climb Light. Powered by Google Gemini.</p>
            <p style="margin-top: 0.5rem;">
                <a href="privacy.html" style="color: var(--text-muted); margin: 0 1rem;">개인정보 보호정책</a>
                <a href="terms.html" style="color: var(--text-muted); margin: 0 1rem;">이용약관</a>
            </p>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="js/config.js"></script>
    <script src="js/decoration.js"></script>
    <script>
        // Load results from localStorage
        document.addEventListener('DOMContentLoaded', async () => {
            const resultsGrid = document.getElementById('resultsGrid');
            const noResults = document.getElementById('noResults');
            const highlightsJson = localStorage.getItem('climbLight_highlights');

            if (!highlightsJson) {
                resultsGrid.style.display = 'none';
                noResults.style.display = 'block';
                return;
            }

            let highlights = JSON.parse(highlightsJson);

            // Filter out failed analysis (score 0)
            highlights = highlights.filter(h => h.score > 0);

            if (!highlights || highlights.length === 0) {
                resultsGrid.style.display = 'none';
                noResults.style.display = 'block';
                return;
            }

            resultsGrid.innerHTML = ''; // Clear loading
            noResults.style.display = 'none'; // Explicitly hide "no results" message
            resultsGrid.style.display = 'grid'; // Restore grid display

            const decorator = new FrameDecorator();

            // Display each highlight
            highlights.forEach((highlight, index) => {
                const card = decorator.createResultCard(highlight, index);
                resultsGrid.appendChild(card);
            });
        });

        // Share functionality
        document.getElementById('shareBtn').addEventListener('click', async () => {
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: 'Climb Light 하이라이트',
                        text: '제 클라이밍 하이라이트를 확인해보세요! 🧗',
                        url: window.location.href
                    });
                } catch (err) {
                    console.log('Error sharing:', err);
                }
            } else {
                alert('공유하기 기능을 지원하지 않는 브라우저입니다.');
            }
        });
    </script>
</body>

</html>